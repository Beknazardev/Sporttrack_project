<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>SportTrack — Вход</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="logo">SportTrack</div>

<div class="card">
    <h1 data-i18n="login_title">Вход</h1>

    <label data-i18n="login_email_label">Почта</label>
    <input type="email" id="email" placeholder="Email">

    <label data-i18n="login_password_label">Пароль</label>
    <input type="password" id="password" placeholder="Пароль">

    <button id="loginBtn" class="btn-primary" data-i18n="login_button">Войти</button>

    <p id="loginError" class="error-text"></p>

    <div class="links-row">
        <a href="reset_password.html" data-i18n="forgot_password">Забыли пароль?</a>
        <a href="register.html" data-i18n="no_account">Нет аккаунта? Зарегистрироваться</a>
    </div>

    <select id="langSelect" class="lang-select">
        <option value="ru">Рус</option>
        <option value="kz">Қаз</option>
        <option value="en">Eng</option>
    </select>
</div>

<script src="lang.js"></script>
<script>
    const API_BASE = "http://localhost:8000";

    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const loginBtn = document.getElementById("loginBtn");
    const loginError = document.getElementById("loginError");

    loginBtn.addEventListener("click", async () => {
        loginError.textContent = "";

        const email = emailInput.value.trim();
        const password = passwordInput.value.trim();

        if (!email || !password) {
            loginError.textContent = "Введите email и пароль";
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/api/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password })
            });

            if (!res.ok) {
                const err = await res.json().catch(() => ({}));
                loginError.textContent = err.detail || "Ошибка входа";
                return;
            }

            const user = await res.json();

           
            localStorage.setItem("user", JSON.stringify(user));

            if (user.role === "coach") {
                window.location.href = "coach_page.html";
            } else if (user.role === "athlete") {
                window.location.href = "athlete_page.html";
            } else {
                
                window.location.href = "index.html";
            }
        } catch (e) {
            console.error(e);
            loginError.textContent = "Сервер недоступен";
        }
    });

    [emailInput, passwordInput].forEach(el => {
        el.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                loginBtn.click();
            }
        });
    });
</script>

</body>
</html>
